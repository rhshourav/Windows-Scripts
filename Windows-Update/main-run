# ============================================
# Windows Update Control - Launcher
# Author: rhshourav
# Supports: Disable or Enable Windows Update
# ============================================

# URLs to scripts
$disableUrl = 'https://raw.githubusercontent.com/rhshourav/Windows-Scripts/main/Windows-Update/Disable-WindowsUpdate.ps1'
$enableUrl  = 'https://raw.githubusercontent.com/rhshourav/Windows-Scripts/main/Windows-Update/Enable-WindowsUpdate.ps1'

$tempDir = "$env:TEMP\WUControl"
if (-not (Test-Path $tempDir)) { New-Item -Path $tempDir -ItemType Directory | Out-Null }

# -----------------------------
# Prompt user for choice
# -----------------------------
Write-Host "Select an option:" -ForegroundColor Cyan
Write-Host "1. Disable Windows Update"
Write-Host "2. Enable Windows Update"
Write-Host "0. Exit"

$choice = Read-Host "Enter 1 or 2"

switch ($choice) {
    '1' { $scriptUrl = $disableUrl; $action = "Disabling" }
    '2' { $scriptUrl = $enableUrl;  $action = "Enabling"  }
    '0' { Write-Host "Exiting......"; return }
    default { Write-Host "Invalid choice. Exiting."; return }
}

$tempScript = Join-Path $tempDir "WUAction.ps1"

# -----------------------------
# Download the main script
# -----------------------------
Write-Host "[*] Downloading script for $action..."
try {
    Invoke-RestMethod -Uri $scriptUrl -OutFile $tempScript -UseBasicParsing
} catch {
    Write-Error "Failed to download script: $_"
    return
}

# -----------------------------
# Admin check
# -----------------------------
$isAdmin = ([Security.Principal.WindowsPrincipal] `
    [Security.Principal.WindowsIdentity]::GetCurrent()
).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)

if (-not $isAdmin) {
    Write-Host "[*] Requesting administrator privileges..."
    Start-Process powershell "-ExecutionPolicy Bypass -File `"$tempScript`"" -Verb RunAs
    return
}

# -----------------------------
# Run the downloaded script
# -----------------------------
Write-Host "[*] Running $action script as Administrator..."
powershell -ExecutionPolicy Bypass -File $tempScript
